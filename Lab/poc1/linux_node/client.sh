# export LXC_NAME=cl1-ce1
# export VLANLAN=1101
# export OVSLAN=cpe
# export IPv4LAN=192.168.101.11/24
# export IPv4GW=192.168.101.1
# export IPv6LAN=fc00:dead:beef:1101::ffff:11/64
# export IPv6GW=fc00:dead:beef:1101::1

# export LXC_NAME=cl1-ce2
# export VLANLAN=1102
# export OVSLAN=cpe
# export IPv4LAN=192.168.102.11/24
# export IPv4GW=192.168.102.1
# export IPv6LAN=fc00:dead:beef:1102::ffff:11/64
# export IPv6GW=fc00:dead:beef:1102::1

# export LXC_NAME=cl1-ce3
# export VLANLAN=1103
# export OVSLAN=cpe
# export IPv4LAN=192.168.103.11/24
# export IPv4GW=192.168.103.1
# export IPv6LAN=fc00:dead:beef:1103::ffff:11/64
# export IPv6GW=fc00:dead:beef:1103::1

# export LXC_NAME=cl1-ce4
# export VLANLAN=1104
# export OVSLAN=cpe
# export IPv4LAN=192.168.104.11/24
# export IPv4GW=192.168.104.1
# export IPv6LAN=fc00:dead:beef:1104::ffff:11/64
# export IPv6GW=fc00:dead:beef:1104::1


# export LXC_NAME=cl1-evpn1
# export VLANLAN=111
# export OVSLAN=pe11et0
# export IPv4LAN=192.168.111.1/24
# export IPv4GW=192.168.111.254
# export IPv6LAN=fc00:dead:beef:1111::1/64
# export IPv6GW=fc00:dead:beef:1104::ffff:ffff

# export LXC_NAME=cl2-evpn1
# export VLANLAN=111
# export OVSLAN=pe12et0
# export IPv4LAN=192.168.111.2/24
# export IPv4GW=192.168.111.254
# export IPv6LAN=fc00:dead:beef:1111::2/64
# export IPv6GW=fc00:dead:beef:1104::ffff:ffff

# export LXC_NAME=cl3-evpn1
# export VLANLAN=112
# export OVSLAN=pe13et0
# export IPv4LAN=192.168.111.3/24
# export IPv4GW=192.168.111.254
# export IPv6LAN=fc00:dead:beef:1111::3/64
# export IPv6GW=fc00:dead:beef:1104::ffff:ffff

# export LXC_NAME=cl1-evpn2-201
# export VLANLAN=201
# export OVSLAN=pe11et0
# export IPv4LAN=192.168.201.1/24
# export IPv4GW=192.168.201.254
# export IPv6LAN=fc00:dead:beef:1201::1/64
# export IPv6GW=fc00:dead:beef:1201::ffff:ffff

# export LXC_NAME=cl1-evpn2-202
# export VLANLAN=202
# export OVSLAN=pe11et0
# export IPv4LAN=192.168.202.1/24
# export IPv4GW=192.168.202.254
# export IPv6LAN=fc00:dead:beef:1202::1/64
# export IPv6GW=fc00:dead:beef:1202::ffff:ffff

# export LXC_NAME=cl2-evpn2-201
# export VLANLAN=201
# export OVSLAN=pe12et0
# export IPv4LAN=192.168.201.2/24
# export IPv4GW=192.168.201.254
# export IPv6LAN=fc00:dead:beef:1201::2/64
# export IPv6GW=fc00:dead:beef:1201::ffff:ffff

# export LXC_NAME=cl2-evpn2-202
# export VLANLAN=202
# export OVSLAN=pe12et0
# export IPv4LAN=192.168.202.2/24
# export IPv4GW=192.168.202.254
# export IPv6LAN=fc00:dead:beef:1202::2/64
# export IPv6GW=fc00:dead:beef:1202::ffff:ffff

# export LXC_NAME=cl3-evpn2-201
# export VLANLAN=201
# export OVSLAN=pe13et0
# export IPv4LAN=192.168.201.3/24
# export IPv4GW=192.168.201.254
# export IPv6LAN=fc00:dead:beef:1201::3/64
# export IPv6GW=fc00:dead:beef:1201::ffff:ffff

# export LXC_NAME=cl3-evpn2-202
# export VLANLAN=202
# export OVSLAN=pe13et0
# export IPv4LAN=192.168.202.3/24
# export IPv4GW=192.168.202.254
# export IPv6LAN=fc00:dead:beef:1202::3/64
# export IPv6GW=fc00:dead:beef:1202::ffff:ffff

# export LXC_NAME=cl1-evpn-vpws1
# export VLANLAN=301
# export OVSLAN=pe11et0
# export IPv4LAN=192.168.131.1/24
# export IPv4GW=192.168.131.254
# export IPv6LAN=fc00:dead:beef:1131::1/64
# export IPv6GW=fc00:dead:beef:1131::ffff:ffff

# export LXC_NAME=cl2-evpn-vpws1
# export VLANLAN=301
# export OVSLAN=pe12et0
# export IPv4LAN=192.168.131.2/24
# export IPv4GW=192.168.131.254
# export IPv6LAN=fc00:dead:beef:1131::2/64
# export IPv6GW=fc00:dead:beef:1131::ffff:ffff

# export LXC_NAME=cl1-evpn-vpws2
# export VLANLAN=302
# export OVSLAN=pe11et0
# export IPv4LAN=192.168.132.1/24
# export IPv4GW=192.168.132.254
# export IPv6LAN=fc00:dead:beef:1132::1/64
# export IPv6GW=fc00:dead:beef:1132::ffff:ffff

# export LXC_NAME=cl3-evpn-vpws2
# export VLANLAN=301
# export OVSLAN=pe13et0
# export IPv4LAN=192.168.132.2/24
# export IPv4GW=192.168.132.254
# export IPv6LAN=fc00:dead:beef:1132::2/64
# export IPv6GW=fc00:dead:beef:1132::ffff:ffff

# export LXC_NAME=cl1-evpn-vpws3
# export VLANLAN=411
# export OVSLAN=pe11et0
# export IPv4LAN=192.168.141.1/24
# export IPv4GW=192.168.141.254
# export IPv6LAN=fc00:dead:beef:1141::1/64
# export IPv6GW=fc00:dead:beef:1141::ffff:ffff

# export LXC_NAME=cl2-evpn-vpws3
# export VLANLAN=412
# export OVSLAN=pe11et0
# export IPv4LAN=192.168.142.2/24
# export IPv4GW=192.168.142.254
# export IPv6LAN=fc00:dead:beef:1142::2/64
# export IPv6GW=fc00:dead:beef:1142::ffff:ffff


# export LXC_NAME=cl3-evpn-vpws3
# export VLANLAN=411
# export OVSLAN=pe12et0
# export IPv4LAN=192.168.141.3/24
# export IPv4GW=192.168.141.254
# export IPv6LAN=fc00:dead:beef:1141::3/64
# export IPv6GW=fc00:dead:beef:1141::ffff:ffff

# export LXC_NAME=cl4-evpn-vpws3
# export VLANLAN=412
# export OVSLAN=pe12et0
# export IPv4LAN=192.168.142.4/24
# export IPv4GW=192.168.142.254
# export IPv6LAN=fc00:dead:beef:1142::4/64
# export IPv6GW=fc00:dead:beef:1142::ffff:ffff

# export LXC_NAME=cl1-evpn-vpws4
# export VLANLAN=413
# export OVSLAN=pe11et0
# export IPv4LAN=192.168.143.1/24
# export IPv4GW=192.168.143.254
# export IPv6LAN=fc00:dead:beef:1143::1/64
# export IPv6GW=fc00:dead:beef:1143::ffff:ffff

# export LXC_NAME=cl2-evpn-vpws4
# export VLANLAN=414
# export OVSLAN=pe11et0
# export IPv4LAN=192.168.144.2/24
# export IPv4GW=192.168.144.254
# export IPv6LAN=fc00:dead:beef:1144::2/64
# export IPv6GW=fc00:dead:beef:1144::ffff:ffff

# export LXC_NAME=cl3-evpn-vpws4
# export VLANLAN=413
# export OVSLAN=pe13et0
# export IPv4LAN=192.168.143.3/24
# export IPv4GW=192.168.143.254
# export IPv6LAN=fc00:dead:beef:1143::3/64
# export IPv6GW=fc00:dead:beef:1143::ffff:ffff

# export LXC_NAME=cl4-evpn-vpws4
# export VLANLAN=414
# export OVSLAN=pe13et0
# export IPv4LAN=192.168.144.4/24
# export IPv4GW=192.168.144.254
# export IPv6LAN=fc00:dead:beef:1144::4/64
# export IPv6GW=fc00:dead:beef:1144::ffff:ffff

export LXC_NAME=cl1-evpn3
export VLANLAN=511
export OVSLAN=pe11et0
export IPv4LAN=192.168.151.1/24
export IPv4GW=192.168.153.254
export IPv6LAN=fc00:dead:beef:1153::1/64
export IPv6GW=fc00:dead:beef:1153::ffff:ffff

export LXC_NAME=cl2-evpn3
export VLANLAN=511
export OVSLAN=pe12et0
export IPv4LAN=192.168.151.2/24
export IPv4GW=192.168.153.254
export IPv6LAN=fc00:dead:beef:1153::2/64
export IPv6GW=fc00:dead:beef:1153::ffff:ffff


export LXC_NAME=cl3-evpn3
export VLANLAN=511
export OVSLAN=pe13et0
export IPv4LAN=192.168.151.3/24
export IPv4GW=192.168.153.254
export IPv6LAN=fc00:dead:beef:1153::3/64
export IPv6GW=fc00:dead:beef:1153::ffff:ffff

echo "Creating VM ${LXC_NAME}"
lxc copy client ${LXC_NAME}
lxc query --request PATCH /1.0/instances/${LXC_NAME} --data "{
  \"devices\": {
    \"eth0\" :{
       \"name\": \"eth0\",
       \"nictype\": \"bridged\",
       \"parent\": \"${OVSLAN}\",
       \"vlan\" : \"${VLANLAN}\",
       \"type\": \"nic\"
    }
  }
}"
echo "push configuration into node ${LXC_NAME}"
cat << EOF | tee ./interface.conf
auto eth0
iface eth0 inet static
    address ${IPv4LAN}
    gateway ${IPv4GW}
iface eth0 inet6 static
    address ${IPv6LAN}
    gateway ${IPv6GW}
EOF

lxc file push ./interface.conf ${LXC_NAME}/etc/network/interfaces
lxc start ${LXC_NAME}